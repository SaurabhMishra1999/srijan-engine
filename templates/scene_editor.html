<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene Configuration - Srijan Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00d4ff;
        }

        h1 {
            font-size: 2.5em;
            color: #00d4ff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00d4ff;
        }

        .subtitle {
            color: #888;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(20, 20, 40, 0.8);
            border: 2px solid #00d4ff;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .panel-title {
            font-size: 1.3em;
            color: #00d4ff;
            margin-bottom: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #00d4ff;
            font-weight: 500;
            font-size: 0.95em;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            background: rgba(50, 50, 80, 0.9);
            border: 1px solid #00d4ff;
            color: #e0e0e0;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            background: rgba(50, 50, 100, 0.9);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .button-group button {
            width: 100%;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff6600 0%, #cc4400 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff66 0%, #00cc44 100%);
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff3366 0%, #cc0033 100%);
        }

        .scene-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #00d4ff;
            border-radius: 5px;
            background: rgba(30, 30, 60, 0.5);
        }

        .scene-item {
            padding: 12px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scene-item:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .scene-item.active {
            background: rgba(0, 212, 255, 0.2);
            border-left: 3px solid #00ffff;
        }

        .scene-info {
            flex: 1;
        }

        .scene-name {
            font-weight: bold;
            color: #00d4ff;
        }

        .scene-desc {
            font-size: 0.85em;
            color: #888;
            margin-top: 3px;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset-btn {
            padding: 8px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            border-radius: 5px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            transform: scale(1.05);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 60px;
            height: 40px;
            padding: 2px;
            cursor: pointer;
        }

        .status-message {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            background: rgba(0, 255, 100, 0.2);
            border: 1px solid #00ff66;
            color: #00ff66;
        }

        .status-error {
            background: rgba(255, 50, 100, 0.2);
            border: 1px solid #ff3366;
            color: #ff3366;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
        }

        .info-item {
            background: rgba(0, 212, 255, 0.05);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .info-label {
            font-size: 0.8em;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1em;
            color: #00d4ff;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #00d4ff;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            color: #888;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            transition: all 0.3s;
            width: auto;
        }

        .tab-btn.active {
            color: #00d4ff;
            border-bottom-color: #00ffff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .object-list, .light-list {
            background: rgba(30, 30, 60, 0.5);
            border: 1px solid #00d4ff;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .list-item {
            padding: 10px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item-name {
            color: #00d4ff;
            font-weight: bold;
        }

        .list-item-type {
            font-size: 0.8em;
            color: #888;
        }

        .remove-btn {
            padding: 5px 10px;
            background: rgba(255, 50, 100, 0.2);
            border: 1px solid #ff3366;
            color: #ff3366;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .remove-btn:hover {
            background: rgba(255, 50, 100, 0.4);
        }

        .position-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .position-inputs input {
            padding: 8px;
            font-size: 0.9em;
        }

        .position-label {
            font-size: 0.85em;
            color: #00d4ff;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ Scene Configuration Studio</h1>
            <p class="subtitle">Design and customize your scenes with full control</p>
        </header>

        <div class="status-message" id="statusMessage"></div>

        <div class="main-grid">
            <!-- Left Panel: Scene Management -->
            <div class="panel">
                <div class="panel-title">üìã Scenes</div>
                
                <div class="form-group">
                    <label>Create New Scene</label>
                    <input type="text" id="sceneName" placeholder="Scene name...">
                    <textarea id="sceneDesc" placeholder="Scene description..."></textarea>
                    <label style="margin-top: 10px;">Duration (seconds)</label>
                    <input type="number" id="sceneDuration" value="5" min="1" max="120">
                    
                    <label style="margin-top: 10px;">Template</label>
                    <select id="sceneTemplate">
                        <option value="">None (Empty Scene)</option>
                        <option value="office">Office</option>
                        <option value="studio">Studio</option>
                        <option value="outdoor">Outdoor</option>
                        <option value="dark_dramatic">Dark Dramatic</option>
                    </select>
                </div>

                <button onclick="createScene()">‚ûï Create Scene</button>

                <div style="margin-top: 20px;">
                    <label>All Scenes</label>
                    <div class="scene-list" id="scenesList">
                        <div style="padding: 20px; text-align: center; color: #888;">
                            No scenes yet. Create one to begin!
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Scene Editor -->
            <div class="panel">
                <div class="panel-title">‚öôÔ∏è Scene Editor</div>
                
                <div id="noSceneSelected" style="text-align: center; padding: 40px; color: #888;">
                    Select or create a scene to edit
                </div>

                <div id="sceneEditor" style="display: none;">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab('settings')">Settings</button>
                        <button class="tab-btn" onclick="switchTab('lighting')">Lighting</button>
                        <button class="tab-btn" onclick="switchTab('objects')">Objects</button>
                        <button class="tab-btn" onclick="switchTab('camera')">Camera</button>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-content active" id="tab-settings">
                        <div class="form-group">
                            <label>Scene Name</label>
                            <input type="text" id="editSceneName" disabled>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="editSceneDesc"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Duration (seconds)</label>
                            <input type="number" id="editSceneDuration" min="1" max="120">
                        </div>
                        <div class="form-group">
                            <label>Background Color</label>
                            <div class="color-picker">
                                <input type="color" id="bgColor" class="color-input">
                                <span id="bgColorValue">#000000</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ambient Light Strength</label>
                            <input type="range" id="ambientLight" min="0" max="1" step="0.1" value="0.5">
                            <span id="ambientValue">0.5</span>
                        </div>
                        <button onclick="updateScene()">üíæ Save Scene Settings</button>
                    </div>

                    <!-- Lighting Tab -->
                    <div class="tab-content" id="tab-lighting">
                        <div class="form-group">
                            <label>Lighting Presets</label>
                            <div class="preset-grid" id="lightingPresetsGrid">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Color Grading Presets</label>
                            <div class="preset-grid" id="colorPresetsGrid">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div id="lightsList" class="light-list">
                            <!-- Populated by JS -->
                        </div>
                        <div class="form-group">
                            <label>Add Light</label>
                            <input type="text" id="lightName" placeholder="Light name...">
                            <select id="lightType">
                                <option value="SUN">Sun</option>
                                <option value="POINT">Point</option>
                                <option value="AREA">Area</option>
                                <option value="SPOT">Spot</option>
                            </select>
                            <label>Position</label>
                            <div class="position-inputs">
                                <div>
                                    <div class="position-label">X</div>
                                    <input type="number" class="lightPos" data-axis="0" value="0" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Y</div>
                                    <input type="number" class="lightPos" data-axis="1" value="0" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Z</div>
                                    <input type="number" class="lightPos" data-axis="2" value="10" step="0.5">
                                </div>
                            </div>
                            <label style="margin-top: 10px;">Energy</label>
                            <input type="number" id="lightEnergy" value="2" min="0" max="10" step="0.1">
                        </div>
                        <button onclick="addLight()">‚ûï Add Light</button>
                    </div>

                    <!-- Objects Tab -->
                    <div class="tab-content" id="tab-objects">
                        <div id="objectsList" class="object-list">
                            <!-- Populated by JS -->
                        </div>
                        <div class="form-group">
                            <label>Add Object</label>
                            <input type="text" id="objName" placeholder="Object name...">
                            <select id="objType">
                                <option value="prop">Prop</option>
                                <option value="character">Character</option>
                                <option value="environment">Environment</option>
                            </select>
                            <label style="margin-top: 10px;">Position</label>
                            <div class="position-inputs">
                                <div>
                                    <div class="position-label">X</div>
                                    <input type="number" class="objPos" data-axis="0" value="0" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Y</div>
                                    <input type="number" class="objPos" data-axis="1" value="0" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Z</div>
                                    <input type="number" class="objPos" data-axis="2" value="0" step="0.5">
                                </div>
                            </div>
                            <label style="margin-top: 10px;">Color</label>
                            <input type="color" id="objColor">
                        </div>
                        <button onclick="addObject()">‚ûï Add Object</button>
                    </div>

                    <!-- Camera Tab -->
                    <div class="tab-content" id="tab-camera">
                        <div class="form-group">
                            <label>Camera Position</label>
                            <div class="position-inputs">
                                <div>
                                    <div class="position-label">X</div>
                                    <input type="number" id="camX" value="0" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Y</div>
                                    <input type="number" id="camY" value="-10" step="0.5">
                                </div>
                                <div>
                                    <div class="position-label">Z</div>
                                    <input type="number" id="camZ" value="5" step="0.5">
                                </div>
                            </div>
                            <label style="margin-top: 10px;">Field of View (FOV)</label>
                            <input type="number" id="camFOV" value="50" min="1" max="170" step="1">
                            <label style="margin-top: 10px;">Focal Length</label>
                            <input type="number" id="camFocal" value="50" min="1" max="300" step="1">
                        </div>
                        <button onclick="setCamera()">üì∑ Set Camera</button>
                    </div>

                    <div class="button-group" style="margin-top: 20px;">
                        <button class="btn-secondary" onclick="exportScene()">üíæ Export</button>
                        <button class="btn-danger" onclick="deleteScene()">üóëÔ∏è Delete</button>
                    </div>

                    <div class="info-grid" id="sceneInfo">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentScene = null;
        let allScenes = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadScenes();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Auto-save scene duration
            document.getElementById('editSceneDuration').addEventListener('change', updateScene);
            document.getElementById('editSceneDesc').addEventListener('change', updateScene);
            
            // Color picker
            document.getElementById('bgColor').addEventListener('input', function() {
                document.getElementById('bgColorValue').textContent = this.value;
            });

            // Ambient light range
            document.getElementById('ambientLight').addEventListener('input', function() {
                document.getElementById('ambientValue').textContent = this.value;
            });
        }

        function showStatus(message, type = 'success') {
            const el = document.getElementById('statusMessage');
            el.textContent = message;
            el.className = `status-message status-${type}`;
            el.style.display = 'block';
            setTimeout(() => {
                el.style.display = 'none';
            }, 3000);
        }

        function loadScenes() {
            fetch('/api/scenes')
                .then(r => r.json())
                .then(data => {
                    updateScenesList(data.scenes || []);
                    loadLightingPresets();
                    loadColorPresets();
                })
                .catch(e => showStatus('Error loading scenes: ' + e, 'error'));
        }

        function updateScenesList(scenes) {
            const list = document.getElementById('scenesList');
            if (!scenes || scenes.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">No scenes yet</div>';
                return;
            }

            list.innerHTML = scenes.map(s => `
                <div class="scene-item" onclick="selectScene('${s.name}')">
                    <div class="scene-info">
                        <div class="scene-name">${s.name}</div>
                        <div class="scene-desc">${s.description}</div>
                    </div>
                    <div style="color: #888; font-size: 0.8em;">${s.duration?.toFixed(1)}s</div>
                </div>
            `).join('');
        }

        function selectScene(name) {
            currentScene = name;
            document.getElementById('noSceneSelected').style.display = 'none';
            document.getElementById('sceneEditor').style.display = 'block';

            fetch(`/api/scenes/${name}`)
                .then(r => r.json())
                .then(data => {
                    const info = data.info;
                    document.getElementById('editSceneName').value = name;
                    document.getElementById('editSceneDesc').value = info.description;
                    document.getElementById('editSceneDuration').value = info.duration;
                    
                    // Update lights list
                    const lightsList = document.getElementById('lightsList');
                    if (data.lights.length > 0) {
                        lightsList.innerHTML = data.lights.map(l => `
                            <div class="list-item">
                                <div>
                                    <div class="list-item-name">${l.name}</div>
                                    <div class="list-item-type">${l.type} (Energy: ${l.energy})</div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        lightsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">No lights</div>';
                    }

                    // Update objects list
                    const objsList = document.getElementById('objectsList');
                    if (data.objects.length > 0) {
                        objsList.innerHTML = data.objects.map(o => `
                            <div class="list-item">
                                <div>
                                    <div class="list-item-name">${o.name}</div>
                                    <div class="list-item-type">${o.type}</div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        objsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">No objects</div>';
                    }

                    updateSceneInfo(info);
                })
                .catch(e => showStatus('Error loading scene: ' + e, 'error'));
        }

        function createScene() {
            const name = document.getElementById('sceneName').value;
            const desc = document.getElementById('sceneDesc').value;
            const duration = document.getElementById('sceneDuration').value;
            const template = document.getElementById('sceneTemplate').value;

            if (!name) {
                showStatus('Please enter scene name', 'error');
                return;
            }

            const payload = { name, description: desc, duration: parseFloat(duration) };
            if (template) payload.template = template;

            fetch('/api/scenes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus(`Scene "${name}" created!`);
                    document.getElementById('sceneName').value = '';
                    document.getElementById('sceneDesc').value = '';
                    loadScenes();
                } else {
                    showStatus(data.error, 'error');
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function updateScene() {
            if (!currentScene) return;

            const payload = {
                description: document.getElementById('editSceneDesc').value,
                duration: parseFloat(document.getElementById('editSceneDuration').value),
                background_color: hexToRgb(document.getElementById('bgColor').value),
                ambient_light_strength: parseFloat(document.getElementById('ambientLight').value)
            };

            fetch(`/api/scenes/${currentScene}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus('Scene updated');
                    loadScenes();
                } else {
                    showStatus(data.error, 'error');
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function deleteScene() {
            if (!currentScene) return;
            if (!confirm(`Delete scene "${currentScene}"?`)) return;

            fetch(`/api/scenes/${currentScene}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showStatus('Scene deleted');
                        currentScene = null;
                        document.getElementById('noSceneSelected').style.display = 'block';
                        document.getElementById('sceneEditor').style.display = 'none';
                        loadScenes();
                    }
                })
                .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function loadLightingPresets() {
            fetch('/api/lighting-presets')
                .then(r => r.json())
                .then(data => {
                    const grid = document.getElementById('lightingPresetsGrid');
                    grid.innerHTML = data.presets.map(p => `
                        <button class="preset-btn" onclick="applyLighting('${p}')">
                            ${p.toUpperCase()}
                        </button>
                    `).join('');
                });
        }

        function loadColorPresets() {
            fetch('/api/color-grading-presets')
                .then(r => r.json())
                .then(data => {
                    const grid = document.getElementById('colorPresetsGrid');
                    grid.innerHTML = data.presets.map(p => `
                        <button class="preset-btn" onclick="applyColorGrading('${p}')">
                            ${p.toUpperCase()}
                        </button>
                    `).join('');
                });
        }

        function applyLighting(preset) {
            if (!currentScene) {
                showStatus('Select a scene first', 'error');
                return;
            }

            fetch(`/api/scenes/${currentScene}/lighting`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ preset })
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus(`Applied lighting preset: ${preset}`);
                    selectScene(currentScene);
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function applyColorGrading(preset) {
            if (!currentScene) {
                showStatus('Select a scene first', 'error');
                return;
            }

            fetch(`/api/scenes/${currentScene}/color-grading`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ preset })
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus(`Applied color grading: ${preset}`);
                    selectScene(currentScene);
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function addLight() {
            if (!currentScene) {
                showStatus('Select a scene first', 'error');
                return;
            }

            const pos = [
                parseFloat(document.querySelector('[data-axis="0"].lightPos').value),
                parseFloat(document.querySelector('[data-axis="1"].lightPos').value),
                parseFloat(document.querySelector('[data-axis="2"].lightPos').value)
            ];

            const payload = {
                name: document.getElementById('lightName').value,
                type: document.getElementById('lightType').value,
                position: pos,
                energy: parseFloat(document.getElementById('lightEnergy').value)
            };

            fetch(`/api/scenes/${currentScene}/lights`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus('Light added');
                    document.getElementById('lightName').value = '';
                    selectScene(currentScene);
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function addObject() {
            if (!currentScene) {
                showStatus('Select a scene first', 'error');
                return;
            }

            const pos = [
                parseFloat(document.querySelector('[data-axis="0"].objPos').value),
                parseFloat(document.querySelector('[data-axis="1"].objPos').value),
                parseFloat(document.querySelector('[data-axis="2"].objPos').value)
            ];

            const payload = {
                name: document.getElementById('objName').value,
                type: document.getElementById('objType').value,
                position: pos,
                color: document.getElementById('objColor').value
            };

            fetch(`/api/scenes/${currentScene}/objects`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus('Object added');
                    document.getElementById('objName').value = '';
                    selectScene(currentScene);
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function setCamera() {
            if (!currentScene) {
                showStatus('Select a scene first', 'error');
                return;
            }

            const payload = {
                name: 'Main Camera',
                position: [
                    parseFloat(document.getElementById('camX').value),
                    parseFloat(document.getElementById('camY').value),
                    parseFloat(document.getElementById('camZ').value)
                ],
                fov: parseFloat(document.getElementById('camFOV').value),
                focal_length: parseFloat(document.getElementById('camFocal').value)
            };

            fetch(`/api/scenes/${currentScene}/camera`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showStatus('Camera configured');
                } else {
                    showStatus(data.error, 'error');
                }
            })
            .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function exportScene() {
            if (!currentScene) return;
            
            fetch(`/api/scenes/${currentScene}/export`)
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        showStatus(`Scene exported to: ${data.path}`);
                    }
                })
                .catch(e => showStatus('Error: ' + e, 'error'));
        }

        function updateSceneInfo(info) {
            const grid = document.getElementById('sceneInfo');
            grid.innerHTML = `
                <div class="info-item">
                    <div class="info-label">Objects</div>
                    <div class="info-value">${info.objects_count}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Lights</div>
                    <div class="info-value">${info.lights_count}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Duration</div>
                    <div class="info-value">${info.duration?.toFixed(1)}s</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Resolution</div>
                    <div class="info-value">${info.resolution[0]}x${info.resolution[1]}</div>
                </div>
            `;
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [
                parseInt(result[1], 16) / 255,
                parseInt(result[2], 16) / 255,
                parseInt(result[3], 16) / 255
            ] : [0, 0, 0];
        }
    </script>
</body>
</html>
